---
title: "Sam_lmer_apuntes"
author: "DaniRRS"
date: "2025-03-11"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## SAM LMER

2 individuos por especie

13 especies

tengo un factor random con 26 niveles

Cada individuo se midio ocn dos circunstancias:

- SAM RADIATION
- en IR sin componente luminica

Se quiere medir a que tasa se calienta cada escarabajo

El ensayo se hace dos veces con cada individuo en IR y SAM.

26*4 = 104

Tendré 104 filas. 

Tengo individuo 1 y 2 de cada especie y los numero 1 2 3 4 no 1 2 1 2 porque el 1 de una especie no es igual que el 1 de otra. 

Generamos distintos modelos con la mista parte fija:

temp ~ t_sonda + fuente*spp 

y diferentes aleatorias

(1|id)


Siempre que trabajemos con diseños factoriales, es más, cuando interaccionan entre sí deberíamos utilizar lo que se denominan contrastes ortogonales. Hay dos modos de convertir los factores con niveles a numeros.

Un factor por ejemplo con 13 niveles lo puedo convertir en columnas tantas como tiene el factor con unos y 0 es una dumi. R compara cada nivel del factor con un baseline, ese será 1 y esl resto compara. R usa contr.treatment y cuando usas factores que interaccionan esto no sirve y no es correcto. 


```{r}
contr.sum()
contr.treatment() #usa r y es erronea
```


Para diseños con factores con interacciones hay que 

```{r}
options(contrasts=c(factor="contr.sum", ordered="contr.poly"))

```

Esto modelos realizan una busqueda de la solución de forma asintótica e iterativa. Hay dos líneas de control para controlar estos procesos. 118, 119.

lmer.0 <- lmer(a_por_b ~ 1 + (1|id), data=datos, control=control.lmer, REML=TRUE)

¿Hemos metido algun termino fijo? no solo el intercepto
¿hemos metido algun aleatorio? si el id

En este modelo si hago table(datos$id,table$especie) veo 0 no puedo random slopes para especie

table(datos$fuente,datos$especie) podríamos anidar fuente y especie o ver cruzamiento. No hay 0

> r.squaredGLMM(lmer.0)
     R2m       R2c
[1,]   0 0.1978784

la marginal tiene 0 
la condicional mete todo fijo + aleatorios

Indica que es poco repetible porque esto se la repetibilidad